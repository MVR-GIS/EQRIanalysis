
```{r}
library(readr)
library(dplyr)
```

```{r install-db-packages}
#| eval: false

# Install DBI
install.packages("DBI")

# Install latest ROracle version from source
## - Download source from CRAN: https://cran.r-project.org/web/packages/ROracle/index.html
## - Save to downloads folder e.g.: C:\Users\B5PMMMPD\Downloads\ROracle_1.5-1.tar.gz
install.packages("C:/Users/B5PMMMPD/Downloads/ROracle_1.5-1.tar.gz", repos = NULL, type = "source")
remotes::install_github("MVR-GIS/usaceki")
```

```{r get-live-data}
#| eval: false

# Get live data
usaceki:::get_qri_connection(set_key = TRUE)
```

```{r}
#| eval: true

# get latest .csv 
latest_export <- "UR_QRI_RESPONSE_EDA_20260122.csv"
```

```{r get-static-data}
# Get static export
responses_raw <- read_csv(latest_export)
column_types <- spec(responses_raw)
column_types
column_types$cols$PROJECT_ID <- col_integer()
column_types$cols$SUBPROJECT_ID  <- col_integer()
column_types$cols$RESPONSE_UID  <- col_integer()
column_types$cols$QUESTIONNAIREEVENT_ID  <- col_integer()
column_types$cols$QUESTION_NUMBER  <- col_integer()
column_types$cols$MILESTONE_ID  <- col_integer()
column_types$cols$PROGRAMTYPE_ID  <- col_integer()

responses_clean <- readr::read_csv(
    latest_export,
    col_types = column_types)
```

```{r data-prep}
responses <- responses_clean %>%
    mutate(
        PROGRAMTYPE_NAME = case_when(
            PROGRAMTYPE_ID == 1 ~ "Military",
            PROGRAMTYPE_ID == 2 ~ "Civil Works"
        )
    ) %>%
    relocate(PROGRAMTYPE_NAME, .after = PROGRAMTYPE_ID)
```

```{r save-data}
saveRDS(responses, "responses.rds")
```
